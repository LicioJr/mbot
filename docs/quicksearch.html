<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"modules.list.html":{"id":"modules.list.html","title":"Modules","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Modules Classes db logger × Search results Close "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Classes Classes db logger × Search results Close "},"index.html":{"id":"index.html","title":"Index","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger MBotA modular bot framework. Git Repository: https://github.com/liciojr/mbot NPM Package: https://www.npmjs.com/package/mbot SetupQuick Start Clone this repository; Install dependencies: npm i Start: npm start New Project Create a project: npm init -y; Install library and dependencies: npm i --save mbot Create json configuration files in /config (default 'dev' environment); Create javascript modules in /bot_modules and /kb; Create app.js with: require('mbot').init(); Run: node app.js Features modular structure (e.g. communication, knowledge base, classifier, utilities), facilitating collaborative working; centralized multi-environment configuration; flexible integrated logging; universal database abstraction (Sails Waterline) for relational and NoSQL databases; global filesystem overlay; automatic lifecycle management with asynchronous init/dispose; extensible adapters (e.g. console, rest, xmpp, test); helper plugins (e.g. logger, HTML parser/scraper, spreadsheet reader, test stub, HTTP/HTTPS). Configuration plain JSON format; standard path convention (/config/dir/name.{env}.json); extensible configuration, with MBOT_NODE_ENV and MBOT_NODE_ENV_ALT environment variables (allow partial redefinition); built-in environments: dev: development (default) tst: test automation prd: production automatic init setup with config modules property; system variable support in any value, replaced at runtime in mbot.config loader:{ ... &quot;key&quot;: &quot;${ENV_VAR_X}&quot; ... Logging 'util/logger' helper with integrated configuration; shared use with core mbot.logger(); allow multiple transport channels and categories. Database Abstraction 'util/db' helper for direct Waterline integration (without Sails); multiple relational (MySQL, PostgreSQL, FileMaker, Apache Derby, ...) and NoSQL (MongoDB, Redis, OrientDB, ...) database adapters, with same interface; multiple source model integration; allow custom adapters creation; built-in (zero configuration) disk/memory adapter for fast prototyping and test automation. Overlay and Lifecycle Management core function mbot.load uses filesystem overlay (mbot.path) to import (require) a module, and save its init/dispose callback (if exists); async single/multiple initialization, to instant or previous loaded modules (mbot.init); async global dispose (mbot.dispose). AdaptersModules in /adapters folder, with init and onEvent (observer pattern) functions, allowing easily creation of custom adapters. Choose and configure in config/core/brain.{env}.json file, at adapter.type key. Built-in adapters: console.js - command-line interface adapter, configuration example: &quot;adapter&quot;: { &quot;type&quot;: &quot;console&quot;, &quot;from&quot;: &quot;admin@localhost&quot;, &quot;prompt&quot;: &quot;[question] &quot; } xmpp.js - XMPP protocol adapter, configuration example: &quot;adapter&quot;: { &quot;type&quot;: &quot;xmpp&quot;, &quot;setPresence&quot;: { &quot;status&quot;: &quot;chat&quot;, &quot;text&quot;: &quot;alpha version&quot; }, &quot;settings&quot;: { &quot;jid&quot;: &quot;mbot@localhost&quot;, &quot;password&quot;: &quot;${MBOT_XMPP_PWD}&quot;, &quot;host&quot;: &quot;localhost&quot;, &quot;port&quot;: 5222 } } rest.js - REST service adapter, configuration example: &quot;adapter&quot;: { &quot;type&quot;: &quot;rest&quot;, &quot;get&quot;: &quot;/mbot&quot;, &quot;port&quot;: 8080 } test.js - Test automation adapter, configuration example: &quot;adapter&quot;: { &quot;type&quot;: &quot;test&quot;, &quot;from&quot;: &quot;usr1&quot; } ArchitectureThe solution has the following structure: config: central configuration directory ({module}.{environment}.json format); adapters: front-end modules (e.g. XMPP, REST, Console); bot_modules: communication modules (specialized dialogs); kb: knowledge base; lib/core: asynchronous core and subsystems facade; nlp: natural language processing modules; util: utilities (e.g. HTML extractor, spreadsheet reader, HTTP consumer, database integration, logger). Applications should focus on bot_modules and kb sections. Workflow SummaryA main controller (lib/core/brain) execute the following tasks: read config/core/brain.{env}.json configuration; load model and open database configured in db key; invoke core loader (lib/index) to fetch configured modules in loader.bot_modules key from config/index.{env}.json; load language module configured in nlp key; invoke core asynchronous global init; load and start adapter configured in adapter key; register adapter onReply event and wait for requests. For each request, the main controller creates a dialog object with some properties: { from: 'user abc', text: 'question xyz', bots: {}, action: '', entities: [], nonEntities; [] }The language module fills action/entities/nonEntities fields information, and bots property with a list of compatible communication modules. By default, following rules apply: if none or 3+ modules are compatible, will return brain.message.unknown configured message; if 2 modules are compatible, will return help text from this modules, for user refinement; if only one module is compatible, it will be invoked to format a reply. Collaborative WorkThe framework was designed to allow multiple concurrent development on the same repository. To accomplish this, follow these steps: define a user tag, example: u01; clone bot_modules/templates/hello_bot to bot_modules/u01/hello_bot, replacing &quot;template&quot; with &quot;u01&quot; in keywords array:module.exports = { keywords: ['u01'], reply } clone config/index.template.json to config/index.u01.json, replacing &quot;templates&quot; with &quot;u01&quot; in &quot;loader.bot_modules&quot; section:{ &quot;loader&quot;: { &quot;bot_modules&quot;: { &quot;u01&quot;: &quot;*&quot; }, ... define environment variable MBOT_NODE_ENV with u01, and start MBOT; type &quot;u01&quot; to receive a welcome message; to customize main controller features, clone config/core/brain.template.json to config/core/brain.u01.json, replacing whatever you want; any Knowledge Base modules in kb/* can be used, or a new directory kb/u01 can be created to add new ones. Bot ModulesNLP ModulesConfigure a Natural Language Processing module with nlp.type key in config/core/brain.{env}.json file, example: &quot;nlp&quot;: { &quot;type&quot;: &quot;bayes&quot;, &quot;stemmer&quot;: &quot;node_modules/natural/lib/natural/stemmers/porter_stemmer.js&quot; }Built-in modules: nlp/hashtag: deterministic classifier, based on rules; nlp/bayes: natural classifier, with Naive-Bayes algorithm. To create a NLP module, implement a classify function in nlp folder, with 2 arguments: a dialog and a callback. Remember to configure nlp.type key. Current Named Entity Recognition use a simplified rule set: text between quotes, example: how old is &quot;Peter Parker&quot;? [&quot;Peter Parker&quot;] simple number, example: sum 5 and 6 [&quot;5&quot;, &quot;6&quot;] uppercase word, except sentence starter, example: What is Peter phone? [&quot;Peter&quot;] Communication ModulesFiles under bot_modules folder, with following interface: Required: keywords property (string array): first element required (master keyword for deterministic classifier). Other keywords used for natural language classifier; reply(dialog, callback) function; Optional: actions property (object): action dictionary, each entry with keywords string/array; help property (string): help text. Examples: currency_bot.js - display a list of countries related to a currency symbol, example: which countries use &quot;GBP&quot; currency? &quot;BRL&quot; country degree_bot.js - temperature conversion bot, examples: 95 to celsius 35 to fahrenheit echo_bot.js - simple echo message, example: some echo here geo_bot.js - display your/some IP address location, examples: my address? ip of &quot;github.com&quot; google_bot.js - show latest technology news from google site, example: tech news hobby_bot.js - user hobby list manager, examples: please, include a new hobby for me: Carpentry show my hobbies Knowledge Base ModulesAny file under kb folder. Examples: currency_kb.js - use util/spreadsheet internal helper to read information from a spreadsheet file; degree_kb.js - use soap external library to consume a public SOAP webservice at webservicex.net; geo_kb.js - use nodejs native http to consume a public REST service at http://freegeoip.net; google_kb.js - use util/webparser internal helper to extract information from a Google HTML page; hobby_kb.js - use util/db internal helper to interact with a database. TestsFirst time, type npm install to fetch dependencies, then type npm test. Test support: adapters/test.js: expose &quot;request&quot; method for test automation; util/test.js: utility helper for test implementation, compatible with Mocha framework; test/examples/*: implementation examples. LicenseGNU Lesser General Public License (LGPL), version 3 or later. See the LICENSE file in the root directory or https://www.gnu.org/licenses/lgpl.html. × Search results Close "},"db.html":{"id":"db.html","title":"Class: db","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Class: db db new db(cfg) Universal database abstraction (use Sails Waterline). Interface: https://github.com/balderdashy/sails-docs/blob/master/contributing/adapter-specification.md Usage: http://sailsjs.com/documentation/concepts/models-and-orm Available/Custom adapters: http://sailsjs.com/documentation/concepts/extending-sails/adapters Parameters: Name Type Description cfg Object Configuration Properties Name Type Description adapters Object Adapters alias/name dictionary connections Object Connections alias/configuration dictionary Methods dispose(cb) Dispose/Close database connection. Parameters: Name Type Description cb function Callback open(model, cb) Open database connection. Model definition: https://github.com/balderdashy/waterline-docs/blob/master/models/configuration.md Parameters: Name Type Description model Object Model definition. cb function Callback × Search results Close "},"logger.html":{"id":"logger.html","title":"Class: logger","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Class: logger logger new logger( [name]) Generic logger. If file 'config/name.{env}.json' exists, use 'logger' configuration key. Use mbot.logger() for integrated setup/dispose. Parameters: Name Type Argument Description name string &lt;optional&gt; Logger name (default 'index') Example var logger = mbot.load('util/logger'); var log = new logger('dir/name'); Methods debug(msg [, cb]) Register a debug message. Parameters: Name Type Argument Description msg string Message cb function &lt;optional&gt; Callback dispose( [cb]) Dispose the logger. Parameters: Name Type Argument Description cb function &lt;optional&gt; Callback error(msg [, cb]) Register an error message. Parameters: Name Type Argument Description msg string Message cb function &lt;optional&gt; Callback info(msg [, cb]) Register an information message. Parameters: Name Type Argument Description msg string Message cb function &lt;optional&gt; Callback × Search results Close "},"module-lib_index.html":{"id":"module-lib_index.html","title":"Module: lib/index","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Module: lib/index Modules loader, featuring filesystem overlay, configuration support, init/dispose management and helpers. Methods &lt;static&gt; config(name) Load a config file, considering environment variables. Parameters: Name Type Description name string Relative pathname. &lt;static&gt; configPath(name) Return full path for a config file, based on environment. Parameters: Name Type Description name string Full name (e.g. 'dir/name') &lt;static&gt; dispose(cb) Dispose all initiated modules, that have a dispose function. Parameters: Name Type Description cb function Callback &lt;static&gt; init( [mods], cb) Initialize one or more modules. If [mods] is empty, execute bootstrap (first time) or init previous loaded modules. Parameters: Name Type Argument Description mods string | Object &lt;optional&gt; Module name or dictionary name list. Properties Name Type Argument Description config Object &lt;optional&gt; Optional init configuration. cb function Callback with initialized modules dictionary. Properties Name Type Description $initError string Undefined or error information. Example mbot.init({ 'util/db': { config: {...} } }) &lt;static&gt; load(file [, cfg]) Load module(s). Encapsulate 'require', use filesystem overlay and save init/dispose callback. Usage: (a) file name (optional init config): return one module object; (b) directory name (e.g. 'bot_modules'): use 'loader' subkey information in config/index.{env}.json, and return a modules dictionary. Wildcard &quot;*&quot; include subdirectories, while &quot;.&quot; load only current directory. Parameters: Name Type Argument Description file string Relative pathname. cfg Object &lt;optional&gt; Optional Configuration &lt;static&gt; logger( [name]) Use/Create a shared logger, with automatic dispose. If file 'config/name.{env}.json' exists, use 'logger' configuration key. Parameters: Name Type Argument Description name string &lt;optional&gt; Logger name (default: 'index') Example var log = mbot.logger('dir/name'); &lt;static&gt; path(file) Return full path for a file, within a filesystem overlay between application (precedence) and framework files. Parameters: Name Type Description file string Relative pathname. × Search results Close "},"module-util_format.html":{"id":"module-util_format.html","title":"Module: util/format","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Module: util/format Format helpers. Methods &lt;static&gt; clean(text) Remove multiple white-spaces, tab, form feed and line feed from a text. Parameters: Name Type Description text string Text to clean. Example var format = mbot.load('util/format'); format.clean(' a b\\t\\t\\nc\\n d \\n\\ne '); // 'a b c d e' &lt;static&gt; list(ii) Format a list with prefix, header and trailer. Parameters: Name Type Description ii Input Information Properties Name Type Argument Description prefix string &lt;optional&gt; Records prefix (default '&gt; ') header string &lt;optional&gt; Header text list Array.&lt;string&gt; Text array footer string &lt;optional&gt; Footer text Example var format = mbot.load('util/format'); format.list({ header: 'result:', list: ['first', 'record #2'], footer: '(2 results)' }); // result: // &gt; first // &gt; record #2 // (2 results) &lt;static&gt; string(str, args) Format string placeholders with sequential arguments. Parameters: Name Type Description str string Template string. args Array.&lt;Object&gt; Example var format = mbot.load('util/format'); format.string('foo {0}: {1}', 'bar', 42); // foo bar: 42 × Search results Close "},"module-util_html.html":{"id":"module-util_html.html","title":"Module: util/html","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Module: util/html HTML parser/scraper utilities. Methods &lt;static&gt; extract(ii, cb) Extract HTML information from a URL (http/https/file). Parameters: Name Type Description ii Object Input Information Properties Name Type Argument Description page string URL ('http://', 'https://' or 'file://') selector string | Array.&lt;string&gt; CSS selector encoding string &lt;optional&gt; HTML encoding (default 'utf8') paginate string &lt;optional&gt; CSS selector for pagination result string &lt;optional&gt; Result object CSS selectors cb function Callback Properties Name Type Description er Error Error data string | Array.&lt;string&gt; Output data Example var html = mbot.load('util/html'); html.extract({ page: 'https://news.google.com/news/', selector: ['h2 &gt; a &gt; .titletext'] }, function(er, data) { if (er) console.log('error: ' + er); else console.log('data: ' + data.join('\\n')); }); × Search results Close "},"module-util_http.html":{"id":"module-util_http.html","title":"Module: util/http","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Module: util/http HTTP utilities. Methods &lt;static&gt; get(ii, cb) Get HTTP/HTTPS data. Parameters: Name Type Description ii Object Input Information Properties Name Type Description url string URL ('http://', 'https://' or 'file://') encoding string Text encoding (default 'utf8') cb function Callback Properties Name Type Description er Error data string Example var http = mbot.load('util/http'); http.get({ url: 'https://github.com/search?q=chat' }, function(er, data) { if (er) console.log('error: ' + er); else console.log('data: ' + data); }); × Search results Close "},"module-util_nlp.html":{"id":"module-util_nlp.html","title":"Module: util/nlp","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Module: util/nlp Natural Language Processing utilities. Methods &lt;static&gt; BayesClassifier( [stemmer]) Create a Bayes Classifier object. Parameters: Name Type Argument Description stemmer Object &lt;optional&gt; Optional stemmer. &lt;static&gt; entitiesExtraction(dialog) Named Entity extraction. Parameters: Name Type Description dialog Object Properties Name Type Description text string Input text. entities Array.&lt;string&gt; Entities list (output). nonEntities Array.&lt;string&gt; Non Entities lowercased list (output). × Search results Close "},"module-util_spreadsheet.html":{"id":"module-util_spreadsheet.html","title":"Module: util/spreadsheet","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Module: util/spreadsheet Spreadsheet utilities. Methods &lt;static&gt; readAll(ii) Read all sheets (sync). Parameters: Name Type Description ii Object Input Information Properties Name Type Description filename string Full path filename Returns: Sheet dictionary to rows array with column dictionary. Type Object &lt;static&gt; readOne(ii) Read one sheet (sync). Parameters: Name Type Description ii Object Input Information Properties Name Type Argument Description filename string Full path filename sheetname string &lt;optional&gt; Sheet name (default first sheet) Returns: Rows array with column dictionary. Type Array.&lt;Object&gt; × Search results Close "},"module-util_test.html":{"id":"module-util_test.html","title":"Module: util/test","body":" Documentation Modules lib/indexutil/formatutil/htmlutil/httputil/nlputil/spreadsheetutil/test Classes dblogger Module: util/test Test automation helper. Methods &lt;static&gt; requestTest(name, tests) Request helper. Parameters: Name Type Description name string Test name tests Array.&lt;Object&gt; Test list Properties Name Type Description request string Request text expected string Expected reply text × Search results Close "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
